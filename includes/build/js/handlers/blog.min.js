import{createAlert as e}from"alert";import{getWrapper as t,postWrapper as o}from"fetch";import{resizeHomeCards as n}from"home";import{$loading as l,$submitBtn as a}from"loading";export const $blogListDiv=document.getElementById("blogList");const r=document.getElementById("submitBlogComment"),d=document.getElementById("blogComment"),i=document.getElementById("blogData"),c=document.getElementById("blogList"),g=document.getElementById("blogDiv");export const blogFetchStruct={loadingBlogs:!1,currOffset:0,count:4,max:20};export async function getBlogs({$div:e,count:o,offset:a,showImage:r,exclude:d,sidebar:i,max:g}){return t({url:`/blog/get/count/${o}/offset/${a}/showimage/${r}/exclude/${d}/sidebar/${i}`,$loadingDiv:0===a?e:null,loading:l,dataHandler:t=>{0===a&&(e.innerHTML="");let l=document.createElement("div");l.innerHTML=t,e.appendChild(l),document.getElementById("homeCards")&&n(),blogFetchStruct.currOffset=a+o,blogFetchStruct.currOffset<g&&window.innerHeight>e.offsetHeight?getBlogs({$div:e,count:blogFetchStruct.count,offset:blogFetchStruct.currOffset,showImage:r,exclude:d,sidebar:i,max:blogFetchStruct.max}):addEventListener("scroll",async()=>{window.innerHeight+window.scrollY>=c.scrollHeight-500&&!blogFetchStruct.loadingBlogs&&blogFetchStruct.currOffset<g&&(blogFetchStruct.loadingBlogs=!0,await getBlogs({$div:e,count:blogFetchStruct.count,offset:blogFetchStruct.currOffset,showImage:r,exclude:d,sidebar:i,max:blogFetchStruct.max}),blogFetchStruct.loadingBlogs=!1)})}})}function rawParser(e){return e.data.html}function codeParser(e){return`<pre style='margin-left: ${e.tunes.indentTune.indentLevel}rem'><code>${e.data.code}</code></pre>`}function imageParser(e){return`<img src='${e.data.file.url}' alt='${e.data?.caption??"Extra blog image"}' class='extraBlogImage'/>`}export const runtime={all:()=>{if(g){const t=new EditorJS({holder:"blogDiv",placeholder:"Blog content...",tools:{paragraph:{class:Paragraph,config:{preserveBlank:!0}},header:{class:Header,config:{levels:[1,2,3,4,5,6],defaultLevel:3}},raw:RawTool,image:{class:ImageTool,config:{endpoints:{byFile:"/blog/addImage"},types:"images/webp"}},list:{class:EditorjsList,inlineToolbar:!0,config:{defaultStyle:"unordered"}},quote:{class:Quote,config:{quotePlaceholder:"Enter a quote",captionPlaceholder:"Quote's author"}},code:CodeTool},data:bodyJson}),n=document.getElementById("submitBlog");n.addEventListener("click",()=>{!async function submitBlog(t,n,l){let r=document.getElementById("blogheader").value,d=await t.save();if(!r.length||!d.blocks.length)return e(document.getElementById("blogAlert"),"danger","bi-exclamation-diamond-fill","Invalid Blog Add"),!1;let i=edjsHTML({raw:rawParser,code:codeParser,image:imageParser}).parse(d),c=new FormData(document.getElementById("writeblogform"));return c.append("blogbodyjson",JSON.stringify(d)),c.append("blogbody",JSON.stringify(i)),o({url:l,$loadingBtn:n,loading:a,packet:c,responseType:"json",dataHandler:t=>{if(!t.success)throw n.disabled=!1,n.innerHTML="Write Blog",e(document.getElementById("blogAlert"),"danger","bi-exclamation-diamond-fill","Invalid Blog Add"),Error(t.message);window.location="/home"}})}(t,n,document.getElementById("writeblogform").dataset.submit)})}$blogListDiv&&getBlogs({$div:$blogListDiv,count:blogFetchStruct.count,offset:0,showImage:!0,exclude:$blogListDiv.dataset.blogid,sidebar:!0,max:blogFetchStruct.max})},read:()=>{r&&r.addEventListener("click",()=>{!async function submitBlogComment(t,n){if(!t.value.length)return;let l=new FormData;return l.append("comment",JSON.stringify(t.value)),l.append("blogid",i.dataset.blogid),o({url:"/blog/addComment",$loadingBtn:n,loading:a,packet:l,responseType:"json",dataHandler:o=>{if(!o.success)throw n.disabled=!1,n.innerHTML="Add Comment",e(document.getElementById("commentAlert"),"danger","bi-exclamation-diamond-fill","Error adding comment. Please try again in a few minutes."),Error(o.message);t.value="",window.location.reload()}})}(d,r)})}};