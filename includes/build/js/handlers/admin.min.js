import{createAlert as e}from"alert";import{initCopyIcons as t}from"copy";import{getWrapper as a,postWrapper as n}from"fetch";import{$submitBtn as d}from"loading";import{startMetricsSocket as r}from"socket";const o=document.getElementById("listTrainers"),l={},s=document.getElementById("fastMoveTable"),c=document.getElementById("chargeMoveTable"),i=document.querySelectorAll(".moveLink"),m=document.getElementById("auditLog"),g=document.getElementById("requestLog"),u=document.getElementById("listPokemon"),p=document.getElementById("bugLog"),b=document.getElementById("medalData"),y=document.getElementById("cacheData"),h=document.getElementById("taskInfo");async function getEditTrainer(r){return a({url:"/admin/editTrainer/trainerid/"+r,$loadingDiv:null,loading:"",dataHandler:a=>{let r=document.createElement("div");r.innerHTML=a,document.getElementById("loadedModal").appendChild(r),globalModals.$editProfileModal=new bootstrap.Modal(document.getElementById("editProfileModal"),{});let o=document.getElementById("editProfileForm"),l=document.getElementById("submitEditProfileForm");l.addEventListener("click",async t=>{let a=o.checkValidity();if(o.classList.add("was-validated"),!a)return t.preventDefault(),void t.stopPropagation();let r=new FormData(o),s=Object.fromEntries(r.entries());await async function updateProfile(t,a){return n({url:"/trainer/updateProfile",$loadingBtn:a,loading:d,packet:JSON.stringify(t),responseType:"json",dataHandler:t=>{t.success?window.location.reload():(e(document.getElementById("editProfileAlertDiv"),"danger","bi-exclamation-diamond-fill",t.message,0),a.innerHTML="Submit",a.disabled=!1)}})}(s,l)}),t()}})}function attachEditProfileHandler(){Array.from(document.querySelectorAll(".editTrainer")).forEach(e=>{e.addEventListener("click",async e=>{document.getElementById("editProfileModal")&&document.getElementById("editProfileModal").remove(),await getEditTrainer(e.currentTarget.dataset.trainerid),globalModals.$editProfileModal.show()})})}export const runtime={all:()=>{},auditlog:()=>{new DataTable(m,{ajax:{url:"/admin/getAudits",type:"GET",dataSrc:"data"},columnDefs:[{searchable:!1,targets:0}],order:[[0,"desc"]],serverSide:!0,pageLength:50,scrollY:"calc(100vh - 250px)"})},buglog:()=>{new DataTable(p,{ajax:{url:"/admin/getBugs",type:"GET",dataSrc:"data"},order:[[0,"desc"]],columnDefs:[{orderable:!1,targets:5,render:function(e,t,a,n){return`\n                        <button type="button" class="extendedInfo btn btn-secondary" data-bs-toggle="modal" data-bs-target="#bug-${n.row}">\n                            <i class="bi bi-bug"></i>\n                        </button>\n                        <div \n                            class="modal fade" \n                            id="bug-${n.row}" \n                            tabindex="-1"\n                            data-bs-backdrop="static" \n                            data-bs-keyboard="false"\n                            aria-hidden="true"\n                        >\n                        <div class="modal-dialog modal-xl modal-dialog-scrollable">\n                            <div class="modal-content">\n                                <div class="modal-header">\n                                    <h5 class="modal-title fs-5"><strong>${a[3]}</strong></h5>\n                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>\n                                </div>\n                                <div class="modal-body">\n                                    ${e}\n                                </div>\n                            </div>\n                        </div>\n                    `}}],serverSide:!0,pageLength:50,scrollY:"calc(100vh - 250px)"})},listtrainers:()=>{let e=new DataTable(o,{ajax:{url:"/admin/getTrainers",type:"GET",dataSrc:"data"},columns:[{data:"edit"},{data:"icon"},{data:"username"},{data:"email"},{data:"verified"},{data:"securitylevel"},{data:"lastlogin"}],rowId:e=>e.trainerid,serverSide:!0,order:[[6,"desc"]],columnDefs:[{targets:"_all",className:"align-middle"},{targets:0,orderable:!1,searchable:!1,className:"align-middle text-center",render:(e,t,a)=>`\n                            <button type="button" class="editTrainer btn btn-secondary" data-trainerid="${a.trainerid}">\n                                <i class="bi bi-wrench"></i>\n                            </button>\n                        `},{targets:1,orderable:!1,searchable:!1,className:"align-middle text-center",render:(e,t,a)=>`<img class="profileIcon" src="${a.icon}" alt="${a.iconAltText}" loading="lazy">`},{targets:4,orderable:!1,searchable:!1,className:"align-middle text-center",render:(e,t,a)=>a.verified?'<i class="bi bi-check mx-1"></i>':""},{targets:5,className:"align-middle text-center"}],pageLength:25,lengthMenu:[25,50,100],scrollY:"calc(100vh - 250px)"});e.on("page.dt",function(){attachEditProfileHandler()}),e.on("draw.dt",function(){attachEditProfileHandler()})},listpokemon:()=>{new DataTable(u,{ajax:{url:"/admin/getPokemon",type:"GET",dataSrc:"data"},columns:[{data:"generation"},{data:"number"},{data:"gender"},{data:"name"},{data:"sprite"},{data:"shiny"},{data:"shadow"},{data:"shadowshiny"},{data:"fastmoves"},{data:"chargemoves"},{data:"evolutiontext"}],rowId:e=>e.pokemonid,order:[[0,"asc"],[1,"asc"]],columnDefs:[{targets:[4,5,6,7,8,9,10],orderable:!1,searchable:!1},{targets:3,render:(e,t,a)=>`<a href='/pokemon/${a.ses}' target='_blank'>${a.name}</a>`},{targets:4,className:"text-center",render:(e,t,a)=>`<img class='pokemonIcon' src='${a.sprite}' loading='lazy'>`},{target:5,className:"text-center",render:(e,t,a)=>a.shiny.length?`<img class='pokemonIcon' src='${a.shiny}' loading='lazy'>`:""},{target:6,className:"text-center parent",render:(e,t,a)=>a.shadow?`\n                            <img class='pokemonIcon' src='${a.sprite}' loading='lazy'>\n                            <img class='shadowIcon' src='${a.shadowicon}' loading='lazy'>\n                        `:""},{target:7,className:"text-center parent",render:(e,t,a)=>a.shadowshiny?`\n                            <img class='pokemonIcon' src='${a.shiny}' loading='lazy'>\n                            <img class='shadowIcon' src='${a.shadowicon}' loading='lazy'>\n                        `:""}],serverSide:!0,pageLength:25,lengthMenu:[25,50,100],scrollY:"calc(100vh - 250px)"})},requestlog:()=>{new DataTable(g,{ajax:{url:"/admin/getRequests",type:"GET",dataSrc:"data"},columnDefs:[{searchable:!1,targets:0},{className:"long-cell",targets:[2,5]}],order:[[0,"desc"]],serverSide:!0,pageLength:50,scrollY:"calc(100vh - 250px)"})},serverinfo:()=>{new DataTable(y,{order:[[0,"asc"]],pageLength:50,scrollY:"calc(30vh)"}),r();const e=document.querySelectorAll(".metricsLoading");let t=!0;const a=document.getElementById("jvmChart");let n;const d=document.getElementById("requestChart");let o;const l=document.getElementById("slowRequestsBody"),s=document.getElementById("coresMetric"),c=document.getElementById("processMetric"),i=document.getElementById("systemMetric");document.addEventListener("metricsUpdate",r=>{const m=r.detail;if(!m)return;t&&(e.forEach(e=>{e.classList.add("d-none")}),n=new Chart(a,{type:"doughnut",data:{labels:["Used","Free","Max (Unallocated)"],datasets:[{label:"JVM Memory (MB)",data:[],backgroundColor:["rgba(255, 99, 132, 0.8)","rgba(54, 162, 235, 0.8)","rgba(201, 203, 207, 0.8)"],hoverOffset:4,borderWidth:0}]},options:{responsive:!0,plugins:{legend:{position:"top",labels:{color:"#000000"}}},maintainAspectRatio:!1,devicePixelRatio:3,cutout:"50%"}}),a.classList.remove("d-none"),o=new Chart(d,{type:"line",data:{labels:[],datasets:[{label:"Active Requests",data:[],tension:.3,fill:!1,borderColor:"rgba(54, 162, 235, 0.8)",backgroundColor:"rgba(54, 162, 235, 0.8)"}]},options:{responsive:!0,scales:{x:{ticks:{color:"#495057"},grid:{color:"#FFFFFF"},border:{color:"rgba(108, 117, 125, 0.6)"}},y:{ticks:{color:"#495057",precision:0,stepSize:1},grid:{color:"#FFFFFF"},border:{color:"rgba(108, 117, 125, 0.6)"},beginAtZero:!0}},plugins:{legend:{labels:{color:"#000000"}}},backgroundColor:"transparent",devicePixelRatio:3}}),d.classList.remove("d-none"),t=!1);const g=m.memory.usedMB,u=m.memory.totalMB,p=u-g,b=m.memory.maxMB-u;n.data.datasets[0].data[0]=g,n.data.datasets[0].data[1]=p,n.data.datasets[0].data[2]=b,n.update("none"),o.data.labels=[...o.data.labels.slice(-30),(new Date).toLocaleTimeString()],o.data.datasets[0].data=[...o.data.datasets[0].data.slice(-30),m.concurrency.activeRequests],o.update("none"),l.innerHTML="",m.concurrency.slowRequests.forEach(e=>{const t=document.createElement("tr"),a=new Date(e.time.replace(",","")),n=document.createElement("td");n.textContent=a.toLocaleString(),t.appendChild(n);const d=document.createElement("td");d.textContent=e.urlpath,d.style.whiteSpace="normal",d.style.wordBreak="break-word",t.appendChild(d);const r=document.createElement("td");r.textContent=e.method,t.appendChild(r);const o=document.createElement("td");o.textContent=e.delta,t.appendChild(o);const s=document.createElement("td");s.textContent=e.trainerid,t.appendChild(s),l.appendChild(t)}),s.innerHTML=m.cpu.cores,c.innerHTML=m.cpu.processPercent+"%",i.innerHTML=m.cpu.systemPercent+"%"})},showmedaldata:()=>{new DataTable(b,{ordering:!1,paging:!1,scrollY:"calc(100vh - 250px)"})},showmovedata:()=>{l.fastMoveTable=new DataTable(s,{order:[[0,"asc"]],pageLength:25,scrollY:"calc(100vh - 355px)"}),l.chargeMoveTable=new DataTable(c,{order:[[0,"asc"]],pageLength:25,scrollY:"calc(100vh - 355px)"}),Array.from(i).forEach(e=>{e.addEventListener("click",e=>{let t=e.currentTarget,a=document.querySelector(".moveLink.active");document.getElementById(a.dataset.type+"MoveWrapper").classList.add("d-none"),document.getElementById(t.dataset.type+"MoveWrapper").classList.remove("d-none"),l[t.dataset.type+"MoveTable"].columns.adjust().draw(),a.classList.remove("active"),t.classList.add("active")})})},taskmanager:()=>{new DataTable(h,{order:[[0,"asc"]],paging:!1,searching:!1,scrollX:!0})}};