import{$alertDiv as e,createAlert as t}from"alert";import{$submitBtn as a}from"loading";export const $forms=document.querySelectorAll(".needs-validation");const i=document.getElementById("currentEvent").dataset.sitekey;export async function checkFormValidity(n,c,r=!0){c.preventDefault();let s=n.checkValidity(),o=n.querySelectorAll(".optionalSelect");if(2==o.length&&(""==o[0].value&&""==o[1].value||""!=o[0].value&&""!=o[1].value)&&(s=!1),s||c.stopPropagation(),n.classList.add("was-validated"),s&&r){let r=c.submitter.innerHTML;if(c.submitter.innerHTML=a,c.submitter.disabled=!0,n.classList.contains("verifyRecaptcha")){await async function executeRecaptcha(a){return new Promise(n=>{grecaptcha.ready(()=>{grecaptcha.execute(i,{action:a}).then(a=>{fetch("/verifyrecaptcha",{method:"POST",body:JSON.stringify({recaptchaToken:a})}).then(e=>e.json()).then(a=>(a.success||t(e,"danger","bi-exclamation-diamond-fill",a.message,1),n(a.success)))})})})}(n.dataset.action)||(c.submitter.innerHTML=r,c.submitter.disabled=!1,s=!1)}s&&n.submit()}return s}export async function addValidator(e){Array.from(e).forEach(e=>{e.addEventListener("submit",async t=>{await checkFormValidity(e,t,!0)},!1)})}