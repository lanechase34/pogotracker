class MultiSelect{constructor(e,t={}){this.options=Object.assign({placeholder:"Select item(s)",max:null,search:!0,selectAll:!0,listAll:!0,name:"",width:"",height:"",dropdownWidth:"",dropdownHeight:"",data:[],onChange:function(){},onSelect:function(){},onUnselect:function(){}},t),this.selectElement="string"==typeof e?document.querySelector(e):e;for(const e in this.selectElement.dataset)void 0!==this.options[e]&&(this.options[e]=this.selectElement.dataset[e]);if(this.name=this.selectElement.getAttribute("name")?this.selectElement.getAttribute("name"):"multi-select-"+Math.floor(1e6*Math.random()),!this.options.data.length){let e=this.selectElement.querySelectorAll("option");for(let t=0;t<e.length;t++)this.options.data.push({value:e[t].value,text:e[t].innerHTML,selected:e[t].selected,html:e[t].getAttribute("data-html")})}this.element=this._template(),this.selectElement.replaceWith(this.element),this._updateSelected(),this._eventHandlers()}_template(){let e="";for(let t=0;t<this.data.length;t++)e+=`\n                <div class="multi-select-option${this.selectedValues.includes(this.data[t].value)?" multi-select-selected":""}" data-value="${this.data[t].value}">\n                    <span class="multi-select-option-radio"></span>\n                    <span class="multi-select-option-text">${this.data[t].html?this.data[t].html:this.data[t].text}</span>\n                </div>\n            `;let t="";!0!==this.options.selectAll&&"true"!==this.options.selectAll||(t='<div class="multi-select-all">\n                <span class="multi-select-option-radio"></span>\n                <span class="multi-select-option-text">Select all</span>\n            </div>');let l=`\n            <div class="multi-select ${this.name}"${this.selectElement.id?' id="'+this.selectElement.id+'"':""} style="${this.width?"width:"+this.width+";":""}${this.height?"height:"+this.height+";":""}">\n                ${this.selectedValues.map(e=>`<input type="hidden" name="${this.name}[]" value="${e}">`).join("")}\n                <div class="multi-select-header" style="${this.width?"width:"+this.width+";":""}${this.height?"height:"+this.height+";":""}">\n                    <span class="multi-select-header-max">${this.options.max?this.selectedValues.length+"/"+this.options.max:""}</span>\n                    <span class="multi-select-header-placeholder">${this.placeholder}</span>\n                </div>\n                <div class="multi-select-options" style="${this.options.dropdownWidth?"width:"+this.options.dropdownWidth+";":""}${this.options.dropdownHeight?"height:"+this.options.dropdownHeight+";":""}">\n                    ${!0===this.options.search||"true"===this.options.search?'<input type="text" class="multi-select-search" placeholder="Search...">':""}\n                    ${t}\n                    ${e}\n                </div>\n            </div>\n        `,s=document.createElement("div");return s.innerHTML=l,s}_eventHandlers(){let e=this.element.querySelector(".multi-select-header");if(this.element.querySelectorAll(".multi-select-option").forEach(t=>{t.onclick=()=>{let l=!0;if(t.classList.contains("multi-select-selected"))t.classList.remove("multi-select-selected"),this.element.querySelectorAll(".multi-select-header-option").forEach(e=>e.dataset.value==t.dataset.value?e.remove():""),this.element.querySelector(`input[value="${t.dataset.value}"]`).remove(),this.data.filter(e=>e.value==t.dataset.value)[0].selected=!1,l=!1;else{if(this.options.max&&this.selectedValues.length>=this.options.max)return;t.classList.add("multi-select-selected"),!0!==this.options.listAll&&"true"!==this.options.listAll||e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option" data-value="${t.dataset.value}">${t.querySelector(".multi-select-option-text").innerHTML}</span>`),this.element.querySelector(".multi-select").insertAdjacentHTML("afterbegin",`<input type="hidden" name="${this.name}[]" value="${t.dataset.value}">`),this.data.filter(e=>e.value==t.dataset.value)[0].selected=!0}!1!==this.options.listAll&&"false"!==this.options.listAll||(this.element.querySelector(".multi-select-header-option")&&this.element.querySelector(".multi-select-header-option").remove(),e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option">${this.selectedValues.length} selected</span>`)),this.element.querySelector(".multi-select-header-option")?this.element.querySelector(".multi-select-header-placeholder")&&this.element.querySelector(".multi-select-header-placeholder").remove():e.insertAdjacentHTML("afterbegin",`<span class="multi-select-header-placeholder">${this.placeholder}</span>`),this.options.max&&(this.element.querySelector(".multi-select-header-max").innerHTML=this.selectedValues.length+"/"+this.options.max),!0!==this.options.search&&"true"!==this.options.search||(this.element.querySelector(".multi-select-search").value=""),this.element.querySelectorAll(".multi-select-option").forEach(e=>e.style.display="flex"),this.options.onChange(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t),l?this.options.onSelect(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t):this.options.onUnselect(t.dataset.value,t.querySelector(".multi-select-option-text").innerHTML,t),document.querySelector(".multi-select-search").focus({focusVisible:!0})}}),e.onclick=()=>e.classList.toggle("multi-select-header-active"),!0===this.options.search||"true"===this.options.search){let e=this.element.querySelector(".multi-select-search");e.oninput=()=>{this.element.querySelectorAll(".multi-select-option").forEach(t=>{t.style.display=t.querySelector(".multi-select-option-text").innerHTML.toLowerCase().indexOf(e.value.toLowerCase())>-1?"flex":"none"})}}if(!0===this.options.selectAll||"true"===this.options.selectAll){let e=this.element.querySelector(".multi-select-all");e.onclick=()=>{let t=e.classList.contains("multi-select-selected");this.element.querySelectorAll(".multi-select-option").forEach(e=>{let l=this.data.find(t=>t.value==e.dataset.value);l&&(t&&l.selected||!t&&!l.selected)&&e.click()}),e.classList.toggle("multi-select-selected")}}this.selectElement.id&&document.querySelector('label[for="'+this.selectElement.id+'"]')&&(document.querySelector('label[for="'+this.selectElement.id+'"]').onclick=()=>{e.classList.toggle("multi-select-header-active")}),document.addEventListener("click",t=>{t.target.closest("."+this.name)||t.target.closest('label[for="'+this.selectElement.id+'"]')||e.classList.remove("multi-select-header-active")})}_updateSelected(){!0===this.options.listAll||"true"===this.options.listAll?this.element.querySelectorAll(".multi-select-option").forEach(e=>{e.classList.contains("multi-select-selected")&&this.element.querySelector(".multi-select-header").insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option" data-value="${e.dataset.value}">${e.querySelector(".multi-select-option-text").innerHTML}</span>`)}):this.selectedValues.length>0&&this.element.querySelector(".multi-select-header").insertAdjacentHTML("afterbegin",`<span class="multi-select-header-option">${this.selectedValues.length} selected</span>`),this.element.querySelector(".multi-select-header-option")&&this.element.querySelector(".multi-select-header-placeholder").remove()}get selectedValues(){return this.data.filter(e=>e.selected).map(e=>e.value)}get selectedItems(){return this.data.filter(e=>e.selected)}set data(e){this.options.data=e}get data(){return this.options.data}set selectElement(e){this.options.selectElement=e}get selectElement(){return this.options.selectElement}set element(e){this.options.element=e}get element(){return this.options.element}set placeholder(e){this.options.placeholder=e}get placeholder(){return this.options.placeholder}set name(e){this.options.name=e}get name(){return this.options.name}set width(e){this.options.width=e}get width(){return this.options.width}set height(e){this.options.height=e}get height(){return this.options.height}}